<head>
<!-- Fonts-->
<link href="https://fonts.googleapis.com/css?family=Exo+2|Open+Sans" rel="stylesheet"> 

<style>
  body {
    background-color: #005376;
    font-family: 'Open Sans', sans-serif;
    /* min-width: 900 px;
    max-width: 1000 px; */
  }

  h1,
  h2 {
    color: #005376;
    font-family: 'Exo 2', sans-serif;
  }

  h3 {
    color: #84BD00;
  }

  div {
    word-wrap: normal;
  }

  #page {
    background-color: #FFFFFF;
    /* border: 1px solid #000000; */
    margin: 10px auto 10px auto;
    padding: 10px 20px 10px 20px;
    min-width: 900px;
    max-width: 1000px;
  }

  #logo-header {
    /* width: 800px; */
    margin: 0px auto;
  }

  img.logo-header {
    width: 300px;
    display: block;
    margin: 0px auto;
  }

  table,
  th,
  td {
    border: 1px solid black;
    border-collapse: collapse;
  }
</style>

<!-- Use MathJax to render mathematics -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>


<div id="page">
<title>Report</title>

<div id="logo-header">
  <img src="{{ QuESt_Logo }}" alt="QuESt logo" class="logo-header" />
</div>

<center><h1>Behind-the-Meter Energy Storage Cost Savings Report</h1></center>

<center><i>Autogenerated using QuESt BTM</i></center>
<center><h4> {{ today }} </h4></center>

{{ header }}

<h2>Scenario Summary</h2>

{% for component in summary_components %}
<div>
  <b>{{ component.name }}:</b> {{ component.value }}
</div>
<br />
{% endfor %}

{% if pv_profile_summary %}
<h3>Photovoltaic Power Profile</h3>

{% for parameter in pv_profile_summary %}
<div>
  {{ parameter }}
  <br />
</div>
{% endfor %}
{% endif %}

<br />

<h3>Energy Storage System Parameters</h3>

<div align="center"> <!-- center content -->
<table width="50%", class="center">
  <thead>
  <tr>
    <th>Parameter</th>
    <th>Value</th> 
    <th>Units</th>
  </tr>
  </thead>
  <tbody>
{% for parameter in system_parameters_summary %}
  <tr>
    <td>{{ parameter.name }}</td>
    <td>{{ parameter.value }}</td>
    <td>{{ parameter.units }}</td>
  </tr>
{% endfor %}
  </tbody>
</table>

<h4>Table 1: Energy Storage Device Characteristics</h4>
</div>

<h2>Optimization Formulation</h2>

We solve the following mathematical optimization problem to minimize the monthly bills for utility customers using behind-the-meter energy storage. The notation is described in Table 2 below.

<h3>Variables and constraints</h3>

In this optimization, the independent decision variables include the discharge power \(p_i^\text{d}\) and the charge power \(p_i^\text{c}\) during period \(i\). Note that these powers are seen at the AC side of the ESS and they are non-negative by
convention. They are subjected to the following constraints:

\begin{align}
&0 \leq p_{i}^\text{c} \leq \overline{P} \text{, $\forall i \in H_m $}\label{eq:pc}\\
&0 \leq p_{i}^\text{d} \leq \overline{P} \text{, $\forall i \in H_m $}\label{eq:pd}
\end{align}
where \(H_m\) is the set of all periods in month \(m\).
<br />
<br />
The dependent variables and corresponding constraints include:
<ul>
  <li>The state of energy (SOE) \(S_i\) at the end of period \(i\):
    \begin{align}
    &S_i=\eta_\text{s}S_{i-1}+\tau(\eta_\text{c}p_{i}^\text{c}-p_{i}^\text{d}), \text{ $\forall i \in H_m $} \label{eq:soe}\\
    &S_\text{min} \leq S_i \leq S_\text{max} \label{eq:soe_range} 
    \end{align}  
  </li>
    
  <li>The net load power \(p_i^\text{net}\) during period \(i\):
  \begin{equation}
  p_i^\text{net}=p_i^\text{ld}+p_i^\text{c}-p_i^\text{d}-p_i^\text{pv}, \text{ $\forall i \in H_m$} \label{eq:p_net}
  \end{equation}  
  </li>
  
  <li>The nonnegative net load power \(p_i^\text{+}\) (\(\max\{p_i^\text{net},0\} \)) during period \(i\):
  \begin{equation}
  p_i^\text{+} \geq p_i^\text{net}, \text{ $\forall i \in H_m$} \label{eq:p_pos}
  \end{equation}  
  </li>
  
  <li>The peak load power \(p_m^\text{max}\) of all periods in month \(m\) (non-coincident peak):
  \begin{equation}
  p_m^\text{pk} \geq p_i^\text{net}, \text{ $\forall i \in H_m$} \label{eq:pm_pk}
  \end{equation}  
  </li>
  
  <li>The peak load power \(p_j^\text{max}\) of j-type demand periods in month \(m\) (coincident peaks):
  \begin{equation}
  p_j^\text{pk} \geq p_i^\text{net}, \text{ $\forall j \in D_m, \forall i \in H_j$} \label{eq:pj_pk}
  \end{equation}  
  where \(H_j\) is the set of all j-type demand periods (e.g., \(H_\text{on-peak}\) is the set of all on-peak hours in month \(m\)), and \(D_m\) is the set of all time-of-use demand types in month \(m\) (e.g., \( D_m = \{\text{on-peak, part-peak, off-peak}\}\)).  
  </li>
  
</ul> 

<h3>Objective function</h3>

\begin{equation}
\min_{p^\text{d},p^\text{c}} \text{C}_\text{E} + \text{C}_\text{N} + \text{C}_\text{D}
\end{equation}
subject to constraints (1) to (8), where
\begin{align}
\label{eq:ce}
\text{C}_\text{E}&=\sum\limits_{i\in H_m}p_i^+e_i\\
\label{eq:cn}
\text{C}_\text{N}&=\sum\limits_{i\in H_m}(p_i^\text{net}-p_i^+)n_i\\
\label{eq:cd}
\text{C}_\text{D}&=p_m^\text{pk}d_m + \sum\limits_{j\in D_m}p_j^\text{pk}d_j\\
\end{align}

<br />
<br /> 

<div align="center">
<table width="70%", class="center">
  <tr>
    <th>Parameter</th>
    <th>Description</th> 
    <th>Units</th>
  </tr>
  <tr>
    <td>\( \tau \) </td>
    <td> Duration of each time period </td> 
    <td> hour </td>
  </tr>
  <tr>
    <td>\( H_m \) </td>
    <td> Set of all periods in month \(m\) </td> 
    <td> hour </td>
  </tr>
  <tr>
    <td>\( H_j \) </td>
    <td> Set of all j-type periods in month \(m\) </td> 
    <td> hour </td>
  </tr>
  <tr>
    <td>\( D_m \) </td>
    <td> Set of all TOU demand types in month \(m\) </td> 
    <td> hour </td>
  </tr>
  <tr>
    <td>\( p_i^\text{c} \) </td>
    <td> Charge power during period \(i\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_i^\text{d} \) </td>
    <td> Discharge power during period \(i\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_i^\text{ld} \) </td>
    <td> Load power during period \(i\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_i^\text{pv} \) </td>
    <td> PV power during period \(i\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_i^\text{net} \) </td>
    <td> Net load power during period \(i\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_i^\text{+} \) </td>
    <td> Nonnegative net load power during period \(i\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_m^\text{pk} \) </td>
    <td> Maximum load power of all periods in month \(m\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( p_j^\text{pk} \) </td>
    <td> Maximum load power of all j-type periods in month \(m\) </td> 
    <td> kW </td>
  </tr>
  <tr>
    <td>\( S_i \) </td>
    <td> State of energy (SOE) at the end of period \(i\) </td> 
    <td> kWh </td>
  </tr>
  <tr>
    <td>\( S_\text{min}, S_\text{max}\) </td>
    <td> Operating limits of the ESS </td> 
    <td> kWh </td>
  </tr>
  <tr>
    <td>\( \text{C}_\text{E}\) </td>
    <td> Energy charge of month \(m\) </td> 
    <td> $ </td>
  </tr>
  <tr>
    <td>\( \text{C}_\text{N}\) </td>
    <td> Net-metering charge (negative) of month \(m\) </td> 
    <td> $ </td>
  </tr>
  <tr>
    <td>\( \text{C}_\text{D}\) </td>
    <td> Demand charge of month \(m\) </td> 
    <td> $ </td>
  </tr>
  <tr>
    <td>\( e_i\) </td>
    <td> Energy price during period \(i\) </td> 
    <td> $/kWh </td>
  </tr>
  <tr>
    <td>\( d_m\) </td>
    <td> Flat demand rate of month \(m\) </td> 
    <td> $/kW </td>
  </tr>
  <tr>
    <td>\( d_j\) </td>
    <td> j-type TOU demand rate of month \(m\) </td> 
    <td> $/kW </td>
  </tr>
  
</table>
<h4>Table 2: Notation</h4>
</div> 


This optimization is formulated in Python using <a href="http://www.pyomo.org">Pyomo</a> and solved using the selected numerical solver.


<h3>Assumptions</h3>
The following assumptions were used:
<ul>
  <li> \( \tau\) is 1 hour. </li>
  <li> Power and energy ratings of the ESS are all AC ratings. </li>
  <li> Energy price is always positive. </li>
</ul> 


<h2>Summary of results</h2>

{% for component in executive_summary %}
<p>
{{ component|safe }}
</p>
{% endfor %}

<!-- Figures from wizard reporting screen -->
<div align="center"> <!-- center content -->
{% for chart in charts %}
  <img src="{{ chart.path }}", class="center" width="80%">
  <h3>Fig. {{ chart.ix }}: {{ chart.caption }}</h3>  

{% endfor %}
</div>

<h2> References </h2>  

<div>
  Nguyen, T., and R. Byrne. "Maximizing the cost-savings for time-of-use and net-metering customers using behind-the-meter energy storage systems." Proceedings of the 2017 North American Power Symposium (NAPS). 2017. Available <a href="https://www.sandia.gov/ess-ssl/docs/IEEE_NAPS_17_proof.pdf">here</a>.
</div>

<h2> Acknowledgements </h2>  

{{ acknowledgement }}

<br />
<br />
<img src="{{SNL_image}}" width="40%" align="middle"> &emsp; &emsp; &emsp; &emsp; <img src="{{DOE_image}}" width="15%" align="middle">

</div>
</body>
</html>